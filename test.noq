use std.noq

square :: A^2 = A*A
dist_mul_add :: A*(B + C) = (A*B + A*C)
mul_comm :: A*B = B*A
sum_assoc :: (A + B) + C = A + (B + C)
double_sum :: A + A = 2 * A

square_of_sum :: (a + b)^2 {
    square       | all
    dist_mul_add | all
    mul_comm     | all
    dist_mul_add | all
    sum_assoc    | 0
    sum_assoc    | !1
    mul_comm     | 2
    double_sum   | 0
    square       | !all
}

cube_of_sum :: (A + B)^3 {
  s3             |  0
  pow           |  0
  square_of_sum |  0
  mul_sum_dist  |  0
  mul_comm      |  0
  mul_sum_dist  |  0
  mul_comm      |  0
  pow           |! 0
  s3             |! 0
  mul_sum_dist  |  0
  mul_comm      |  1
  mul_sum_dist  |  0
  mul_comm      |  8
  // TODO: cub_of_sum seems to be broken here
  mul_sum_dist  |  0
  mul_comm      |  8
  pow           |! 0
  s3             |! 0
}