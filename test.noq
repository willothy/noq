#rule swap swap(X(A, B)) = X(B, A);
#rule rot rot(triple(A, B, C)) = triple(C, A, B);
#
#shape swap(pair(f(a), g(b)))
#    apply swap
#    apply rule pair(A, B) = rot(triple(A, B, c));
#    apply rot
#done
#
#rule add0 add(0, X) = X;
#
#rule add add(s(A), B) = s(add(A, B));
#
#shape add(s(s(0)), s(s(s(0))))
#    apply add
#    apply add
#    apply add0
#done

rule square A^2 = A*A
rule dist_mul_add A*(B + C) = A*B + A*C
rule mul_comm A*B = B*A
rule sum_assoc (A + B) + C = A + (B + C)
rule double_sum A + A = 2 * A

shape (a + b)^2
    apply all square
    apply all dist_mul_add
    apply all dist_mul_add
    apply all mul_comm
    apply all dist_mul_add
    apply 0 sum_assoc
    apply 1 reverse sum_assoc
    apply 2 mul_comm
    apply 0 double_sum
    apply all reverse square
done
